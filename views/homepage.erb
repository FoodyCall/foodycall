<!DOCTYPE html>
<html lang="en">
<head>
  <title>FoodyCall - Cook Together, Happy Together</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/homepage.css">
  <!--Import jQuery before materialize.js-->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/js/homepage.js">
  </script>
</head>
<body>

  <!-- EVENT MODAL -->
  <div class="modal fade" id="joinEventModal" tabindex="-1" role="dialog" aria-labelledby="event-modal">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">

        <div class="modal-body">
          <form method="post" action="/events/join">
          <div class="col-lg-12">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <div class="col-lg-10 col-lg-push-1">
              <div class="modal-header">
                <h1>I want to join this event</h1>
                <br/>
                <input class="hidden" id="event-modal-id" name="event_id">
                <div class="col-lg-11 no-padding">
                  <span class="modal-title black" id="event-modal">Title</span>

                    <p class="modal-sub-title">
                      <span class="modal-date"></span>
                      <span class="modal-time"></span>
                      <span class="glyphicon glyphicon-map-marker modal-location-icon location-icon"></span>
                      <a target="_blank" href="https://www.google.com.tw/maps/search/Taipei%20city?hl=en&source=opensearch" class="modal-location"></a>
                      <span class="">Host by</span>
                      <img class="modal-host-img" src="" alt="">
                      <span class="modal-host-name"></span>
                    </p>
                </div>
                <div class="modal-event-availability col-lg-1 pull">
                  <img src="img/par-1-4.png" alt="">
                  <div class="col-lg-12">
                  <p><span class="modal-approved">2</span>/<span class="modal-total">3</span></p>
                </div>
                </div>


              </div>
              <p class="subtitle-tag">1. Choose your roles</p>

              <div class="col-lg-12 roles-container form-group">
                <span class="modal-roles">
                  <div class="modal-role">
                    <a href="">
                    <span class="shopper-role">
                      <img class="role" src="img/role-1.png">
                    </span>
                    <p class="role-name">Shopper</p>
                    <p class="role-quantity shopper" >(0/3)</p>
                    <input type="checkbox" name="roles[]" value="shopper"/>
                    </a>
                  </div>
                  <div class="modal-role">
                    <a class="" href="">
                    <span class="chef-role">
                      <img class="role" src="img/role-2.png">
                    </span>
                    <p class="role-name ">Chef</p>
                    <p class="role-quantity chef" >(0/2)</p>
                    <input type="checkbox" name="roles[]" value="chef"/>
                    </a>
                  </div>
                  <div class="modal-role">
                    <a class="" href="">
                    <span class="helper-role">
                      <img class="role" src="img/role-3.png">
                    </span>
                    <p class="role-name">Helper</p>
                    <p class="role-quantity helper" >(0/1)</p>
                    <input type="checkbox" name="roles[]" value="helper"/>
                    </a>
                  </div>
                  <div class="modal-role">
                    <a class="" href="">
                    <span class="guest-role">
                      <img class="role" src="img/role-4.png">
                    </span>
                    <p class="role-name">Guest</p>
                    <p class="role-quantity guest" >(0/1)</p>
                    <input type="checkbox" name="roles[]" value="guest"/>
                    </a>
                  </div>
                  <div class="modal-role">
                    <a class="" href="">
                    <span class="cleaner-role ">
                      <img class="role" src="img/role-5.png">
                    </span>
                    <p class="role-name">Cleaner</p>
                    <p class="role-quantity cleaner" >(0/1)</p>
                    <input type="checkbox" name="roles[]" value="cleaner">
                    </a>
                  </div>
                </span>
              </div>
              <br/>
              <br/>
              <p class="subtitle-tag">2. Send a message to he host</p>
              <div class=" form-group col-lg-10 col-lg-push-1">
                <textarea class="form-control join-message" name="message" placeholder="Introduce yourself to the host!" rows="5"></textarea>
              </div>

            </div>

          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="join">Join the event</button>
          </div>
          </form>
        </div>

      </div>
    </div>
  </div>
<!-- END OF MODAL-->

  <!-- EVENT MODAL -->
  <div class="modal fade" id="eventModal" tabindex="-1" role="dialog" aria-labelledby="event-modal">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">

        <div class="modal-body">
          <div class="col-lg-2">
            <p class="host-tag">Host</p>
            <img class="modal-host-img" src="" alt="">
            <p class="modal-host-name"> <span class="modal-host-age"> (23)</span></p>
            <!-- <p class="modal-host-username">@alliekrchang</p> -->
            <p class="modal-host-location">Taipei, Taiwan</p>
            <p class="modal-host-stars"></p>
          </div>
          <div class="col-lg-10">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h3 class="modal-title" id="event-modal">Title</h3>
              <span class="hidden" id="event-modal-id">Title</span>
              <p class="modal-sub-title">
                <span class="modal-date"></span>
                <span class="modal-time"></span>
                <span class="glyphicon glyphicon-map-marker modal-location-icon location-icon"></span>
                <a target="_blank" href="https://www.google.com.tw/maps/search/Taipei%20city?hl=en&source=opensearch" class="modal-location"></a>
              </p>
              <div class="modal-event-availability">
                <img src="img/par-1-4.png" alt="">
                <p><span class="modal-approved">2</span>/<span class="modal-total">3</span></p>
              </div>
            </div>
            <p class="subtitle-tag">Participants</p>
            <span class="modal-roles">
              <div class="modal-role">
                <a href="">
                <span class="shopper-role">
                  <img class="role" src="img/role-1.png">
                </span>
                <p class="role-name">Shopper</p>
                <p class="role-quantity shopper" >(0/3)</p>
                </a>
              </div>
              <div class="modal-role">
                <a class="" href="">
                <span class="chef-role">
                  <img class="role" src="img/role-2.png">
                </span>
                <p class="role-name ">Chef</p>
                <p class="role-quantity chef" >(0/2)</p>
                </a>
              </div>
              <div class="modal-role">
                <a class="" href="">
                <span class="helper-role">
                  <img class="role" src="img/role-3.png">
                </span>
                <p class="role-name">Helper</p>
                <p class="role-quantity helper" >(0/1)</p>
                </a>
              </div>
              <div class="modal-role">
                <a class="" href="">
                <span class="guest-role">
                  <img class="role" src="img/role-4.png">
                </span>
                <p class="role-name">Guest</p>
                <p class="role-quantity guest" >(0/1)</p>
                </a>
              </div>
              <div class="modal-role">
                <a class="" href="">
                <span class="cleaner-role">
                  <img class="role" src="img/role-5.png">
                </span>
                <p class="role-name">Cleaner</p>
                <p class="role-quantity cleaner" >(0/1)</p>
                </a>
              </div>
            </span>
            <div class="popover-roles">
              <div class="popover bottom">
                <div class="arrow" style="left: 5.5%"></div>
                <div class="popover-content">
                  
                </div>
              </div>
            </div>
            <p class="subtitle-tag">Menu</p>
            <div class="dishes">
              <div class="dish">
                <img src="https://www.rhodesbread.com/images/recipes/MediterraneanPizzaLarge.jpg" class="dish-img center-cropped" alt="">
                <p class="dish-name">Meat Pizza</p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="join-event">Join the event</button>
          </div>
        </div>

      </div>
    </div>
  </div>
<!-- END OF MODAL-->





<%= erb :nav %>
<div class="container filters">
    <div class="dropdown">
      <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
        Location
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
        <li><a href="#">Option 1</a></li>
        <li><a href="#">Option 2</a></li>
      </ul>
    </div>
    <div class="dropdown">
      <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
        Role
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
        <li><a href="#">Option 1</a></li>
        <li><a href="#">Option 2</a></li>
      </ul>
    </div>
    <div class="dropdown">
      <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
        Host Rating
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenu3">
        <li><a href="#">Option 1</a></li>
        <li><a href="#">Option 2</a></li>
      </ul>
    </div>
</div>
<div class="container events">
  <%= erb :flash_bar %>
  <div class="row"> <!--class="row" -->
    <!--class="col-lg-6 col-md-6 col-sm-12 "-->
    <% if @events %>
    <% @events.each_with_index do |event,index| %>
      <a data-event-id="<%=index%>" class="event-card" href=""><div class="thumbnail right-caption">

        <img class="center-cropped " src="<%= event.img_path%>">
        <div class="caption">
          <h3 class="event-title hidden"><%= event.name %></h3>
          <div id="hidden-info" class="hidden">
            <span class="event-id"><%= event.id%></span>
            <span class="user-id"><%=@user_id %></span>
            <span class="user-joined"><%= event.user_joined?(@user_id)? 'yes' : 'no'%></span>
            <span class="event-total"><%= event.totalParticipants%></span>
            <span class="event-shopper"><%= event.shopper%></span>
            <span class="event-chef"><%= event.chef%></span>
            <span class="event-helper"><%= event.helper%></span>
            <span class="event-guest"><%= event.guest%></span>
            <span class="event-cleaner"><%= event.cleaner%></span>
            <span class="event-approved"><%= event.approved_count%></span>
            <span class="event-shopper-approved"><%= event.shopper_approved_count%></span>
            <span class="event-chef-approved"><%= event.chef_approved_count%></span>
            <span class="event-helper-approved"><%= event.helper_approved_count%></span>
            <span class="event-guest-approved"><%= event.guest_approved_count%></span>
            <span class="event-cleaner-approved"><%= event.cleaner_approved_count%></span>

            <% ["shopper","chef","helper","guest","cleaner"].each do |role| %>
              <div data-event-id="<%=index%>" class="event-participants-<%=role%>-<%=event.id%>">
                <% event.send("approved_#{role}").each_with_index do |participant,index| %>
                  <div class="participant">
                    <img src="<%= participant.user.img_path%>">
                    <div class="">
                      <p><%= participant.user.fullName%> <span class="participant-age">(<%= participant.user.age%>)</span></p>
                      <!-- <p class="participant-username">@garynil</p> -->
                      <p class="participant-location"><%= participant.user.city%>,<%= participant.user.country%></p>
                      <p class="participant-rating">
                        <% event.host.rate.times do |i| %>
                          <span class="star glyphicon glyphicon-star"></span>
                        <% end %>
                        <% (5 - event.host.rate).times do |i| %>
                          <span class="star glyphicon glyphicon-star-empty"></span>
                        <% end %>
                      </p>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>

            <div class="event-menus">
              <% event.menus.each_with_index do |menu,index| %>
                <div id="dish-<%= index%>" class="dish">
                  <img src="<%= menu.img_path %>" class="dish-img center-cropped" alt="">
                  <p class="dish-name"><%= menu.name %></p>
                </div>
              <% end %>
            </div>

            <div>
            </div>
          </div>
          <h3><%= event.name.gsub(/^(.{60,}?).*$/m,'\1...') %></h3>

          <span class="date"><%=event.date.strftime("%Y-%m-%d")%></span> <span class="time"><%=event.date.strftime("%l:%M %p")%></span>
          <span class="glyphicon glyphicon-map-marker location-icon"></span><span class=""><%= event.city + ',' + event.country%></span>
          <span class="location hidden"><%= event.location %></span>
          <br>
          <span class="host_by">Hosted by</span>
          <span class="host-img">
            <img class="" src="<%= event.host.img %>" alt="">
          </span>
          <span class="host-name"><%= event.host.fullName.gsub(/^(.{20,}?).*$/m,'\1...')%></span>
          <span class="host-name-full hidden"><%= event.host.fullName%></span>
          <span class="host-age hidden"><%= event.host.age%></span>
          <span class="stars">
              <% event.host.rate.times do |i| %>
                <span class="star glyphicon glyphicon-star"></span>
              <% end %>
              <% (5 - event.host.rate).times do |i| %>
                <span class="star glyphicon glyphicon-star-empty"></span>
              <% end %>

          </span>
          <br>
          <span class="roles">
            <% if event.shopper > 0 %>
              <img class="role" src="img/role-1.png">
            <% end %>
            <% if event.chef > 0 %>
              <img class="role" src="img/role-2.png">
            <% end %>
            <% if event.helper > 0 %>
              <img class="role" src="img/role-3.png">
            <% end %>
            <% if event.guest > 0 %>
              <img class="role" src="img/role-4.png">
            <% end %>
            <% if event.cleaner > 0 %>
              <img class="role" src="img/role-5.png">
            <% end %>
          </span>
          <span class="event-availability pull-right">
            <% value = event.totalParticipants.size / 4 %>
            <% if event.approved_count >= value * 4 %>
              <img src="img/par-4-4.png" alt="">
            <% elsif event.approved_count >= value * 3%>
              <img src="img/par-3-4.png" alt="">
            <% elsif event.approved_count >= value * 2%>
              <img src="img/par-2-4.png" alt="">
            <% elsif event.approved_count >= value * 1%>
              <img src="img/par-1-4.png" alt="">
            <% else %>
              <img src="img/par-0-4.png" alt="">
            <% end %>

            <p><span><%= event.approved.size %></span>/<span><%= event.totalParticipants %></span></p>
          </span>
        </div>
      </div>
    </a>
    <% end %>
    <% end %>

  </div>

</div>

</body>
</html>
